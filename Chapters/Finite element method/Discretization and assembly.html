
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Discretization and assembly &#8212; My Jupyter Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapters/Finite element method/Discretization and assembly';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Solution" href="Solution.html" />
    <link rel="prev" title="Elements" href="Elements.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">My Jupyter Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Roundoff%20error/Roundoff%20error.html">Round-off Error</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Roundoff%20error/Finite%20precision%20representations.html">Finite precision representations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Roundoff%20error/True_and_approximate_error.html">Quantifying error</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Roundoff%20error/Truncation_error.html">Truncation error</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Linear%20systems/Linear%20systems.html">Linear systems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Linear%20systems/Solvability.html">Solvability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Linear%20systems/Complexity.html">Computational complexity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Linear%20systems/Conditioning.html">Conditioning</a></li>

<li class="toctree-l2 has-children"><a class="reference internal" href="../Linear%20systems/Direct%20methods.html">Direct methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Linear%20systems/Direct%20methods/Gaussian%20elimination.html">Solving linear systems with Gauss elimination</a></li>

<li class="toctree-l3"><a class="reference internal" href="../Linear%20systems/Direct%20methods/LU%20decomposition.html">LU decomposition</a></li>

<li class="toctree-l3"><a class="reference internal" href="../Linear%20systems/Direct%20methods/Matrix%20types%20and%20decompositions.html">Matrix types</a></li>

</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Linear%20systems/Iterative%20methods.html">Iterative methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Linear%20systems/Iterative%20methods/Gauss-Seidel%2C%20Jacobi%2C%20and%20SOR.html">Jacobi iteration method</a></li>




<li class="toctree-l3"><a class="reference internal" href="../Linear%20systems/Iterative%20methods/Conjugate%20gradient%20and%20GMRES.html">Nomenclature</a></li>


<li class="toctree-l3"><a class="reference internal" href="../Linear%20systems/Iterative%20methods/Preconditioners.html">Preconditioners</a></li>


</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Interpolation%20and%20curve%20fitting.html">Interpolation and Curve-fitting</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Interpolation/Interpolation.html">Interpolation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Interpolation/Polynomial%20interpolation.html">Polynomial interpolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Interpolation/Splines.html">Cubic splines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Interpolation/Radial%20basis%20functions.html">Radial Basis Functions</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Curve%20fitting/Curve%20fitting.html">Curve fitting</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Curve%20fitting/Linear%20least%20squares%20regression.html">Linear least squares regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Curve%20fitting/Polyfit.html">Polyfit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Interpolation%20and%20curve%20fitting/Curve%20fitting/Best%20fit%20radial%20basis%20functions.html">Radial Basis Functions revisted!</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Root%20finding/Root%20finding.html">Root finding</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Root%20finding/Polynomial%20roots.html">Polynomial roots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Root%20finding/Closed%20methods.html">Closed root-finding methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Root%20finding/Open%20methods.html">Open methods</a></li>

<li class="toctree-l2"><a class="reference internal" href="../Root%20finding/Global%20convergence%20methods.html">‘Global’ convergence</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Optimization/Optimization.html">Optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Optimization/Closed%20methods.html">Bracketed minimization</a></li>

<li class="toctree-l2"><a class="reference internal" href="../Optimization/Open%20methods.html">Open methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Optimization/Gradient%20based%20optimizers.html">Gradient-based optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Optimization/Indefinite%20systems.html">Indefinite systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Optimization/Trust%20region%20methods.html">Trust region methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Optimization/Nonlinear%20least%20squares.html">Nonlinear least-squares regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Optimization/Equality%20constraints.html">Equality constrained optimization</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Differentiation%20and%20integration/Differentiation%20and%20integration.html">Differentiation and integration</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Differentiation%20and%20integration/Finite%20difference/Finite%20difference.html">Finite difference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Finite%20difference/First%20order%20derivatives.html">First order derivatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Finite%20difference/Second%20order%20derivatives.html">Second order derivatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Finite%20difference/Higher%20dimensions.html">Higher dimensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Finite%20difference/Even%20vs%20uneven%20spacing.html">Even vs uneven spacing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Finite%20difference/Uncertainty%20amplification.html">Uncertainty amplification</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Differentiation%20and%20integration/Integration/Numerical%20integration.html">Numerical integration</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Integration/Newton-Cotes%20formulae.html">Newton-Cotes integration formulae</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Integration/Romberg%20rule.html">Romberg rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differentiation%20and%20integration/Integration/Gaussian%20quadrature.html">Gaussian quadrature</a></li>

</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Differential%20equations/Differential%20equations.html">Differential equations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Differential%20equations/Initial%20value%20problems/Initial%20value%20problems.html">Initial value problems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Differential%20equations/Initial%20value%20problems/Explicit%20methods.html">Explicit methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differential%20equations/Initial%20value%20problems/Implicit%20methods.html">Implicit methods</a></li>

</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Differential%20equations/Boundary%20value%20problems/Boundary_value_problems.html">Boundary value problems</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Differential%20equations/Boundary%20value%20problems/Shooting%20method.html">The Shooting method</a></li>

<li class="toctree-l3"><a class="reference internal" href="../Differential%20equations/Boundary%20value%20problems/Collocation%20methods.html">Collocation algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differential%20equations/Boundary%20value%20problems/Finite_difference_method.html">The Finite Difference method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Differential%20equations/Boundary%20value%20problems/Finite_volume.html">Finite volume methods</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../Differential%20equations/Partial%20differential%20equations/Partial_differential_equations.html">Partial differential equations</a></li>



</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Finite%20element%20method.html">The Finite Element Method</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Motivating%20example.html">Motivating example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Theoretical%20background.html">Theoretical background</a></li>
<li class="toctree-l2"><a class="reference internal" href="Elements.html">Elements</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Discretization and assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="Solution.html">Solution</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/mwelland/ENGPHYS_3NM4/blob/main/Book/Chapters/Finite element method/Discretization and assembly.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mwelland/ENGPHYS_3NM4" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mwelland/ENGPHYS_3NM4/issues/new?title=Issue%20on%20page%20%2FChapters/Finite element method/Discretization and assembly.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Chapters/Finite element method/Discretization and assembly.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Discretization and assembly</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-weak-form">The weak form</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boundary-conditions-terms">Boundary conditions / terms</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretization">Discretization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#small-support-for-shape-functions">Small support for shape functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assembly">Assembly</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-fem-matricies">Summary of FEM Matricies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Solution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-pde">Linear PDE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1d-heat-equation">Example: 1D heat equation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-case">Nonlinear case</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1d-nonlinear-heat-equation">Example: 1D nonlinear heat equation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="discretization-and-assembly">
<h1>Discretization and assembly<a class="headerlink" href="#discretization-and-assembly" title="Link to this heading">#</a></h1>
<section id="the-weak-form">
<h2>The weak form<a class="headerlink" href="#the-weak-form" title="Link to this heading">#</a></h2>
<p>Our usual formulation of BVPs is called the <em>strong</em> form because it assumes a lot of continuity in a solution. E.g.: if the equation contains <span class="math notranslate nohighlight">\(\nabla^2 u\)</span>, the solution assumes that that derivative exists!</p>
<p>The MWR leads to the <em>weak form</em> which has less requirements on the solution, amoungst other benefits. Essentially, all we have to do is multiply through by our test function <span class="math notranslate nohighlight">\(v\)</span> and integrate. Something <em>very</em> useful happens to our divergence-of-flux terms, which are prevelant in conservation equations.</p>
<p>As an example, consider a time dependant heat balance (temperature = <span class="math notranslate nohighlight">\(u\)</span>), using the backward Euler time marching scheme.
$<span class="math notranslate nohighlight">\( \begin{align}
\frac{\partial u}{\partial t} &amp;= -\nabla \cdot \vec{J} \\
\frac{u - u^{t-1}}{\Delta t} &amp;= -\nabla \cdot \vec{J} \\
u + \Delta t [\nabla \cdot \vec{J}] &amp;= u^{t-1}
\end{align}\)</span>$</p>
<p>To get to the weak form, multiply through by the test funciton <span class="math notranslate nohighlight">\(v\)</span> and integrate:</p>
<div class="math notranslate nohighlight">
\[ 0 = \int_{\Omega} u v - \int_{\Omega} u^{t-1}v \  + \Delta t \int_{\Omega}v \nabla \cdot \vec{J} \]</div>
<p>Examining the divergence-of-flux term, we see that we can apply integration by parts followed by the Divergence Theorem:
$<span class="math notranslate nohighlight">\( \begin{align}
\int_\Omega v \nabla \cdot \vec{J}  &amp;= -\int_\Omega \nabla v \cdot \vec{J}  + \int_{\Omega} \nabla \cdot \big[v\vec{J}\big]  \\
&amp;=-\int_\Omega \nabla v \cdot \vec{J}  + \int_{\partial \Omega} v \ \vec{J} \cdot \hat{n} \\
&amp;=\int_\Omega \lambda \nabla v \nabla u  + \int_{\partial \Omega} v \ J_n    
\end{align}\)</span>$</p>
<p>Where we have defined the outward normal boundary flux, <span class="math notranslate nohighlight">\(J_n = \vec{J} \cdot \hat{n}\)</span></p>
<p>The weak form is remarkable since we:</p>
<ul class="simple">
<li><p>replaced a second derivative with the product of two first derivatives.</p></li>
<li><p>no longer require our solution to <em>have</em> a second derivative (it can be less smooth and satisfy the equation in an average sense which is <em>weaker</em> than the <em>strong</em> form)!</p></li>
<li><p>incorporated boundary fluxes directly into the residual calculation (through the surface integral)</p></li>
<li><p>do not require anything from <span class="math notranslate nohighlight">\(\lambda\)</span>, which means this is still valid for <span class="math notranslate nohighlight">\(\lambda(u,x,t...)\)</span>, however it is now outside of the gradient!</p></li>
<li><p>We also provided an avenue for directly integrating surface <em>phenomena</em> into our model through the surface integral!)</p></li>
</ul>
<section id="boundary-conditions-terms">
<h3>Boundary conditions / terms<a class="headerlink" href="#boundary-conditions-terms" title="Link to this heading">#</a></h3>
<p>The term <span class="math notranslate nohighlight">\(\int_{\partial \Omega} v \ \vec{J} \cdot \hat{n}\)</span> is a <em>boundary integral</em> of the <em>normal flux</em>, <span class="math notranslate nohighlight">\(\vec{J}_n = \vec{J} \cdot \hat{n}\)</span>.</p>
<p>Typically, we will have some knowledge of the boundary conditions either:</p>
<ul class="simple">
<li><p>Neumann (flux) boundary condition in which case we have the quantity <span class="math notranslate nohighlight">\(\vec{J}_n\)</span> to insert directly.</p></li>
<li><p>Insulation (zero flux) for which <span class="math notranslate nohighlight">\(\vec{J}_n= 0\)</span> and the term vanishes.</p></li>
<li><p>Dirichlet (value) boundary condition which we would just insert directly into the applicable unknown, e.g.: <span class="math notranslate nohighlight">\(u_0 = 0\)</span> for a boundary <span class="math notranslate nohighlight">\(u(0) = 0\)</span>. In this case, there is still a flux at that boundary but it is determined by the dirichlet condition.</p></li>
</ul>
<p>Some software will opt to implement Dirichlet conditions as a <em>weak constraint</em> which is a Lagrange multiplier formulation in which the lagrange multiple assume the value of the <em>reaction force</em> necesssary to affect that constraint.</p>
</section>
</section>
<section id="discretization">
<h2>Discretization<a class="headerlink" href="#discretization" title="Link to this heading">#</a></h2>
<p>We are now in a position to discretize the weak equation ,</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\int_{\Omega} u v + \Delta t \int_\Omega \lambda \nabla v \nabla u    &amp;= \int_{\Omega} u^{t-1}v - \Delta t \int_{\partial \Omega} v \ J_n\\
\end{align}\end{split}\]</div>
<p>into a form we are able to solve, which will (finally) give us an idea of what the shape functions are.</p>
<section id="small-support-for-shape-functions">
<h3>Small support for shape functions<a class="headerlink" href="#small-support-for-shape-functions" title="Link to this heading">#</a></h3>
<p>The shape functions are generally designed to be non-zero only inside their element. This has the effect of limiting products, <span class="math notranslate nohighlight">\(\int \phi_i \phi_j\)</span> and  <span class="math notranslate nohighlight">\(\int \nabla \phi_i \nabla \phi_j\)</span> to be zero for almost all combination of <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> except for cases where the nodes <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are within the same element!</p>
</section>
</section>
<section id="assembly">
<h2>Assembly<a class="headerlink" href="#assembly" title="Link to this heading">#</a></h2>
<p>The matrix assembly stage involves transforming the weak form into a matrix equation for the unknowns, <span class="math notranslate nohighlight">\(u_i\)</span> such that the approximate solution can be assembled as <span class="math notranslate nohighlight">\(u_h = \sum u_i \phi_i\)</span>.</p>
<p>Consider the term, <span class="math notranslate nohighlight">\(\int_{\Omega} uv\)</span>, recalling <span class="math notranslate nohighlight">\(u_h = \sum u_i \phi_i\)</span> and <span class="math notranslate nohighlight">\(v = \sum_j \phi_j\)</span>. Since integration is a linear operator, we have,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\int_{\Omega} uv  &amp;= \sum_i u_i \int_{\Omega} \phi_i \phi_j \\
&amp;=  \sum_i u_i M_{ij} \\
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(M_{ij}\)</span> is called the <em>Mass</em> matrix.</p>
<p>Similarly,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align} \int_\Omega \lambda \nabla v \nabla u &amp;= \sum_i \lambda(u_i) u_i \int_{\Omega} \nabla \phi_i \nabla \phi_j \\
&amp;=  \sum_i \lambda(u_i) u_i K_{ij}
\end{align}\end{split}\]</div>
<p>which is called the <em>stiffness matrix</em>.</p>
<p>The term
$<span class="math notranslate nohighlight">\(\begin{align}
\int_{\Omega} u^{t-1} v &amp;= \sum_i u^{t-1}_i \int_{\Omega} \phi_i \phi_j \\
&amp;= \sum_i u_i^{t-1} M_{ij} = b_j
\end{align}\)</span><span class="math notranslate nohighlight">\(
but can also be calculated directly since \)</span>u_i^{t-1}$ is known.</p>
<p>Finally we can assemble our equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{align}
\int_{\Omega} u v + \Delta t \int_\Omega \lambda \nabla v \nabla u   &amp;= \int_{\Omega} u^{t-1}v - \Delta t \int_{\partial \Omega} v \ J_n\\
\sum_i u_i M_{ij} + \Delta t \lambda u_i K_{ij}  &amp;= b_j - {J_n}_j \\
\vec{u}_h M + \Delta t \lambda \vec{u}_h K  &amp;= \vec{b} - \vec{J_n}
\end{align}\end{split}\]</div>
<p>The elements of the matrix are can be calculated for a reference element and then simply scaled according to the transformation of the template to the mesh. The integration itself can be analytic, or Gaussian Quadrature (for which Gauss Points would be obtained on the reference element).</p>
<section id="summary-of-fem-matricies">
<h3>Summary of FEM Matricies<a class="headerlink" href="#summary-of-fem-matricies" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Weak Form Term</strong>  …………</p></th>
<th class="head"><p><strong>Matrix Form (FEM)</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\int_\Omega \phi_i \phi_j \, d\Omega\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathbf{M}_{ij} \)</span></p></td>
<td><p>Mass matrix. Often used in time-dependent problems.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\int_\Omega \nabla \phi_i \cdot \nabla \phi_j \, d\Omega\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathbf{K}_{ij} \)</span></p></td>
<td><p>Stiffness matrix. Used in problems like Poisson or elasticity equations.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\int_\Omega \phi_i f \, d\Omega\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathbf{F}_i \)</span></p></td>
<td><p>Load vector. Represents source terms in the governing equation.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\int_{\partial \Omega} \phi_i g \, d\partial \Omega\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathbf{F}_i^{\text{bc}} \)</span></p></td>
<td><p>Boundary load vector (from Neumann boundary conditions).</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Link to this heading">#</a></h2>
<p>We now arrive at a matrix equation for the unknows <span class="math notranslate nohighlight">\(u_i\)</span>, which is mearly a system of equations as we’ve spoken about beforehand.</p>
<section id="linear-pde">
<h3>Linear PDE<a class="headerlink" href="#linear-pde" title="Link to this heading">#</a></h3>
<p>If the PDE is linear, we can solve it with a linear solver which is sparse due to the small support requirement of the elements. The matrix will not in general be banded however, due to the irregular conectivity of the mesh verticies.</p>
<section id="example-1d-heat-equation">
<h4>Example: 1D heat equation<a class="headerlink" href="#example-1d-heat-equation" title="Link to this heading">#</a></h4>
<p>Solve the 1D heat balance equation with <span class="math notranslate nohighlight">\(\lambda = 1\)</span> for <span class="math notranslate nohighlight">\(x\)</span> from 0 to 10 subject to <span class="math notranslate nohighlight">\(J(0)\)</span> = 1 and <span class="math notranslate nohighlight">\(T(10) = 0\)</span>. Initial condition is <span class="math notranslate nohighlight">\(T(x,t=0) = 0\)</span>.</p>
<p>The mass matrix is:
$<span class="math notranslate nohighlight">\(M_{ij} = \int_{x_1}^{x_2} \phi_i(x) \phi_j(x) dx\)</span>$</p>
<p>with</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\phi_1(x) &amp;= \frac{x_2-x}{x_2-x_1} \\
\phi_2(x) &amp;= \frac{x-x_1}{x_2-x_1} \\
\end{align}\end{split}\]</div>
<p>we (Mathematica) get:
$<span class="math notranslate nohighlight">\(
M = \frac{[x_2-x_1]}{6} \begin{bmatrix}
2 &amp; 1 \\
1 &amp; 2
\end{bmatrix}
\)</span>$</p>
<p>The stiffness matrix needs
$<span class="math notranslate nohighlight">\(\begin{align}
\nabla \phi_1(x) &amp;= \frac{-1}{x_2-x_1} \\
\nabla \phi_2(x) &amp;= \frac{1}{x_2-x_1} \\
\end{align}\)</span>$</p>
<p>and
$<span class="math notranslate nohighlight">\( \begin{align}
K_{ij} &amp;= \lambda \int_{x_1}^{x_2} \nabla \phi_i(x) \nabla \phi_j(x) dx\\
 &amp;= \frac{\lambda}{h} \begin{bmatrix}
1 &amp; -1 \\
-1 &amp; 1
\end{bmatrix}
\end{align}\)</span>$</p>
<p>These <em>blocks</em> belong to each element, so we have to build the full matrix by <em>summing them</em>. Note this implies an overlap at common verticies between elements!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prompt: Assemble a a linear system for the heat equation above using the finite element method with Lagrange order 1 elements, using implicit Euler time stepping and a mesh resolution that is concentrated near the left boundary.</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">FloatSlider</span>

<span class="c1"># Define the domain and parameters</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># Length of the domain</span>
<span class="n">n_elements</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of elements</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Time step</span>
<span class="n">t_final</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Final time</span>

<span class="c1"># Create a mesh with concentration near the left boundary</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">L</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))))</span>

<span class="c1"># Define the element stiffness and mass matrices for linear elements</span>
<span class="k">def</span> <span class="nf">element_stiffness</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">element_mass</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span>

<span class="c1"># Assemble the global stiffness and mass matrices</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)))</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Ke</span> <span class="o">=</span> <span class="n">element_stiffness</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">Me</span> <span class="o">=</span> <span class="n">element_mass</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Ke</span>
    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Me</span>

<span class="n">plt</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Apply boundary conditions</span>
<span class="c1"># Dirichlet BC at x = L (T(L) = 0)</span>
<span class="n">K</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">K</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Neumann BC at x = 0 (J(0) = 1)</span>
<span class="c1"># We&#39;ll implement this in the right-hand side vector later.</span>

<span class="c1"># Function to solve and plot for a given time</span>
<span class="k">def</span> <span class="nf">solve_and_plot</span><span class="p">(</span><span class="n">t_final</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_final</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">M</span> <span class="o">@</span> <span class="n">T</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Set the y-axis limits to [0, 1]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature Profile at t = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_final</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Create a slider for the final time</span>
<span class="n">time_slider</span> <span class="o">=</span> <span class="n">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Final Time:&#39;</span><span class="p">)</span>

<span class="c1"># Use interact to link the slider to the function</span>
<span class="n">interact</span><span class="p">(</span><span class="n">solve_and_plot</span><span class="p">,</span> <span class="n">t_final</span><span class="o">=</span><span class="n">time_slider</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/dfbfb8be7b33364ae53cca324a0e49e133650797a0ca9ef4c49dec5b5873e031.png" src="../../_images/dfbfb8be7b33364ae53cca324a0e49e133650797a0ca9ef4c49dec5b5873e031.png" />
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d04e038e67a34a2b8a43c2cf2aaabbe6", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Note that we built the <span class="math notranslate nohighlight">\(M\)</span> and <span class="math notranslate nohighlight">\(K\)</span> matricies once, outside the time loop and reuse them for each time step! Even if we had adaptive time stepping, the matrix wouldn’t change!</p>
</section>
</section>
<section id="nonlinear-case">
<h3>Nonlinear case<a class="headerlink" href="#nonlinear-case" title="Link to this heading">#</a></h3>
<p>If the PDE is nonlinear, we simply have to use a root finder. Note that in this case we are looking for the parameters <span class="math notranslate nohighlight">\(u_i\)</span> directly - the shape functions are unaffected and therefore only the coefficients of the matrix <em>blocks</em> are altered. This brings up the concept of <em>sparsity patterns</em> which can help reduce the overhead of sparse matrix representaitons.</p>
<p>Since modern finite element software needs to construct the weak form, it is usually equiped with symbolic logic capabilities and therefore able to calculate the Jacobian for use in the root finding algorithm.</p>
<section id="example-1d-nonlinear-heat-equation">
<h4>Example: 1D nonlinear heat equation<a class="headerlink" href="#example-1d-nonlinear-heat-equation" title="Link to this heading">#</a></h4>
<p>Repeat the above exercise with <span class="math notranslate nohighlight">\(\lambda = 1 + u/10\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prompt: Solve the heat transport problem again but this time with \lambda = 1+T/10</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">FloatSlider</span>

<span class="c1"># Define the domain and parameters</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># Length of the domain</span>
<span class="n">n_elements</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of elements</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Time step</span>
<span class="n">t_final</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Final time</span>

<span class="c1"># Create a mesh with concentration near the left boundary</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">L</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))))</span>

<span class="c1"># Define the element stiffness and mass matrices for linear elements</span>
<span class="k">def</span> <span class="nf">element_stiffness</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">lambda_val</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">lambda_val</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">element_mass</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span>

<span class="c1"># Assemble the global stiffness and mass matrices</span>
<span class="k">def</span> <span class="nf">assemble_matrices</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Ke</span> <span class="o">=</span> <span class="n">element_stiffness</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">Me</span> <span class="o">=</span> <span class="n">element_mass</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
        <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Ke</span>
        <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Me</span>

    <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">M</span>


<span class="c1"># Apply boundary conditions</span>
<span class="k">def</span> <span class="nf">apply_boundary_conditions</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="c1"># Dirichlet BC at x = L (T(L) = 0)</span>
    <span class="n">K</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">K</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">M</span>

<span class="c1"># Function to solve and plot for a given time</span>
<span class="k">def</span> <span class="nf">solve_and_plot</span><span class="p">(</span><span class="n">t_final</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_final</span><span class="p">:</span>
        <span class="n">K</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">assemble_matrices</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        <span class="n">K</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">apply_boundary_conditions</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">M</span> <span class="o">@</span> <span class="n">T</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Set the y-axis limits to [0, 1]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature Profile at t = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_final</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Create a slider for the final time</span>
<span class="n">time_slider</span> <span class="o">=</span> <span class="n">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Final Time:&#39;</span><span class="p">)</span>

<span class="c1"># Use interact to link the slider to the function</span>
<span class="n">interact</span><span class="p">(</span><span class="n">solve_and_plot</span><span class="p">,</span> <span class="n">t_final</span><span class="o">=</span><span class="n">time_slider</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f66ee64955cc4b438b2bca2809a0a42e", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Hmmmm… something is funny in that code!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prompt: Solve the heat transport problem again but this time with \lambda = 1+T/10 using a root finder</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">FloatSlider</span>


<span class="c1"># Define the domain and parameters</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># Length of the domain</span>
<span class="n">n_elements</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of elements</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Time step</span>
<span class="n">t_final</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Final time</span>

<span class="c1"># Create a mesh with concentration near the left boundary</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">L</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))))</span>

<span class="c1"># Define the element stiffness and mass matrices for linear elements</span>
<span class="k">def</span> <span class="nf">element_stiffness</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">lambda_val</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">lambda_val</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">element_mass</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span>

<span class="c1"># Assemble the global stiffness and mass matrices</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Me</span> <span class="o">=</span> <span class="n">element_mass</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Me</span>

<span class="c1"># Apply boundary conditions</span>
<span class="c1"># Dirichlet BC at x = L (T(L) = 0)</span>
<span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Neumann BC at x = 0 (J(0) = 1)</span>
<span class="c1"># We&#39;ll implement this in the right-hand side vector later.</span>

<span class="c1"># Function to solve for T at the next time step using a root finder</span>
<span class="k">def</span> <span class="nf">solve_for_next_T</span><span class="p">(</span><span class="n">T_prev</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">lambda_val</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># Update lambda based on T</span>
            <span class="n">Ke</span> <span class="o">=</span> <span class="n">element_stiffness</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">lambda_val</span><span class="p">)</span>
            <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Ke</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">M</span> <span class="o">@</span> <span class="n">T_prev</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">M</span> <span class="o">@</span> <span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="n">K</span> <span class="o">@</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span>

    <span class="n">sol</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">T_prev</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>

<span class="c1"># Function to solve and plot for a given time</span>
<span class="k">def</span> <span class="nf">solve_and_plot</span><span class="p">(</span><span class="n">t_final</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_final</span><span class="p">:</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">solve_for_next_T</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature Profile at t = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_final</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Create a slider for the final time</span>
<span class="n">time_slider</span> <span class="o">=</span> <span class="n">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Final Time:&#39;</span><span class="p">)</span>

<span class="c1"># Use interact to link the slider to the function</span>
<span class="n">interact</span><span class="p">(</span><span class="n">solve_and_plot</span><span class="p">,</span> <span class="n">t_final</span><span class="o">=</span><span class="n">time_slider</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "98d349fddaa545f7be55cd1e660e2b40", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "mwelland/ENGPHYS_3NM4",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapters/Finite element method"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Elements.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Elements</p>
      </div>
    </a>
    <a class="right-next"
       href="Solution.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solution</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-weak-form">The weak form</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boundary-conditions-terms">Boundary conditions / terms</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretization">Discretization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#small-support-for-shape-functions">Small support for shape functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assembly">Assembly</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-fem-matricies">Summary of FEM Matricies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Solution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-pde">Linear PDE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1d-heat-equation">Example: 1D heat equation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-case">Nonlinear case</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1d-nonlinear-heat-equation">Example: 1D nonlinear heat equation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>